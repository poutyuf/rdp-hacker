name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # 6 saatte bir otomatik yeniden baÅŸlatma

jobs:
  build:
    name: RDP Kurulumu
    runs-on: windows-latest
    timeout-minutes: 350

    steps:
      - name: Kurulum
        run: |
          Write-Host "ğŸš€ RDP kurulumu baÅŸlÄ±yor..." -ForegroundColor Green
          
          # DosyalarÄ± indir
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"
          
          # Python paketlerini kur
          python.exe -m pip install requests pyautogui telegraph --quiet
          
          # RDP'yi etkinleÅŸtir
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          # KullanÄ±cÄ± adÄ± ve ÅŸifreyi ayarla
          net user poutyuf "!poutyuf!" /add
          net localgroup administrators poutyuf /add
          
          # Avica'yÄ± baÅŸlat
          Write-Host "âš¡ Avica baÅŸlatÄ±lÄ±yor..." -ForegroundColor Yellow
          Start-Process "Avica_setup.exe" -Wait
          
          # Kurulum scriptini Ã§alÄ±ÅŸtÄ±r
          python setup.py
          
          Write-Host "âœ… Kurulum tamamlandÄ±!" -ForegroundColor Green
          
      - name: BaÄŸlantÄ±yÄ± BaÅŸlat
        run: |
          Write-Host "ğŸ”„ BaÄŸlantÄ± bilgileri hazÄ±rlanÄ±yor..." -ForegroundColor Cyan
          cmd /c show.bat
        
      - name: Oturumu Aktif Tut
        run: |
          Write-Host "ğŸŒ RDP oturumu aktif, baÄŸlantÄ± bekleniyor..." -ForegroundColor Yellow
          cmd /c loop.bat
