name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Her 6 saatte bir otomatik yeniden baÅŸlatma

jobs:
  build:
    name: ğŸš€ RDP Kurulum ve YapÄ±landÄ±rma
    runs-on: windows-latest
    timeout-minutes: 350  # Maksimum Ã§alÄ±ÅŸma sÃ¼resi

    steps:
      - name: ğŸ“¥ Gerekli DosyalarÄ± Ä°ndir
        run: |
          Write-Host "Dosyalar indiriliyor..." -ForegroundColor Cyan
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"
          Write-Host "âœ… TÃ¼m dosyalar baÅŸarÄ±yla indirildi" -ForegroundColor Green

      - name: ğŸ Python Paketlerini Kur
        run: |
          Write-Host "Python paketleri yÃ¼kleniyor..." -ForegroundColor Yellow
          python.exe -m pip install requests pyautogui telegraph --quiet --no-warn
          Write-Host "âœ… Python paketleri kuruldu" -ForegroundColor Green

      - name: ğŸ”“ RDP'yi EtkinleÅŸtir
        run: |
          Write-Host "RDP etkinleÅŸtiriliyor..." -ForegroundColor Magenta
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          netsh advfirewall firewall add rule name="Open RDP Port" dir=in action=allow protocol=TCP localport=3389
          Write-Host "âœ… RDP baÅŸarÄ±yla etkinleÅŸtirildi" -ForegroundColor Green

      - name: ğŸ‘¤ KullanÄ±cÄ± HesabÄ± OluÅŸtur
        run: |
          Write-Host "KullanÄ±cÄ± hesabÄ± oluÅŸturuluyor..." -ForegroundColor Cyan
          net user poutyuf "P@ssw0rd!2024" /add /Y
          net localgroup administrators poutyuf /add
          wmic UserAccount where Name='poutyuf' set PasswordExpires=False
          Write-Host "âœ… KullanÄ±cÄ± hesabÄ± oluÅŸturuldu: poutyuf" -ForegroundColor Green

      - name: ğŸ“¦ Avica Kurulumu
        run: |
          Write-Host "Avica kurulumu baÅŸlatÄ±lÄ±yor..." -ForegroundColor Yellow
          Start-Process "Avica_setup.exe" -Wait
          Write-Host "âœ… Avica kurulumu tamamlandÄ±" -ForegroundColor Green

      - name: âš™ï¸ Kurulum Scriptini Ã‡alÄ±ÅŸtÄ±r
        run: |
          Write-Host "Kurulum scripti Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..." -ForegroundColor Magenta
          python setup.py
          Write-Host "âœ… Kurulum scripti tamamlandÄ±" -ForegroundColor Green

      - name: ğŸŒ BaÄŸlantÄ± Bilgilerini HazÄ±rla
        run: |
          Write-Host "BaÄŸlantÄ± bilgileri hazÄ±rlanÄ±yor..." -ForegroundColor Cyan
          Write-Host "â³ GoFile linki oluÅŸturuluyor, lÃ¼tfen bekleyin..." -ForegroundColor Yellow
          timeout /t 15 /nobreak
          cmd /c show.bat

      - name: ğŸ”„ Oturumu SÃ¼rekli Aktif Tut
        run: |
          Write-Host "RDP oturumu baÅŸlatÄ±lÄ±yor..." -ForegroundColor Green
          Write-Host "ğŸ“¡ BaÄŸlantÄ± bilgileri yukarÄ±da gÃ¶zÃ¼kecektir" -ForegroundColor Cyan
          Write-Host "ğŸ”„ Oturum sÃ¼rekli aktif tutuluyor..." -ForegroundColor Magenta
          cmd /c loop.bat
